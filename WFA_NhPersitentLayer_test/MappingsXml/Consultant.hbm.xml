<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping
  assembly="ScrignoV2"
  namespace="ScrignoV2.Business.Entities"
  default-access="property"
  xmlns="urn:nhibernate-mapping-2.2">
  
  <class name="Consultant" optimistic-lock="version">
      
    <id name="ID" column="ID" type="long">
        <generator class="native" />
    </id>
    <version name="Version" type="int" />
    <property name="Name" type="String" />
    <property name="Surname" type="String" />
    <property name="Email" type="String" />
    <property name="IdentityCode" type="int" not-null="false" />
    
    <set name="Agents"
        inverse="true"
        batch-size="10"
        cascade="none"
        table="ConsultantAgent"
        >
        <subselect>
            <![CDATA[
            select IDConsultant, max(BeginDate) as BeginDate, IDAgent FROM ConsultantAgent 
            group by IDConsultant, IDAgent
            ]]>
        </subselect>
        <key column="IDConsultant" not-null="false" />
        <many-to-many class="Consultant" column="IDAgent" not-found="ignore" />
    </set>
    <set name="Contracts"
         inverse="true"
         batch-size="10"
         table="Contract"
         cascade="save-update"
        >
        <key column="FKConsultant" not-null="true" />
        <one-to-many class="Contract" />
    </set>
    <set name="Agencies"
        inverse="true"
        batch-size="10"
        lazy="false"
        cascade="none"
        table="Agency"
        >
        <key column="IDManager" not-null="true" />
        <one-to-many class="Agency" />
    </set>
  </class>
</hibernate-mapping>
